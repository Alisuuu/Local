<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Local Watch Party</title>
<script src="https://unpkg.com/detect-file-encoding-and-language/umd/language-encoding.min.js"></script>
<script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>
<style>
/* Estilos gerais e modo escuro com tons de lilás */
:root {
  --body-bg: #121212; /* Preto mais escuro para o fundo */
  --text-color: #f0f0f0; /* Texto branco/cinza claro */
  --primary-color: #a889d4; /* Lilás principal */
  --secondary-color: #d4bfff; /* Lilás mais claro para detalhes */
  --input-bg: #333; /* Fundo dos inputs */
  --input-color: var(--text-color);
  --border-color: #555; /* Cor da borda */
  --msger-bg: #222; /* Fundo da área de mensagens */
  --left-msg-bg: #444; /* Fundo da mensagem da esquerda */
  --right-msg-bg: var(--primary-color); /* Fundo da mensagem da direita (usuário) */
  --msger-header-bg: #333; /* Fundo do header do chat */
}

body {
  margin: 0;
  font-size: 1.0em;
  color: var(--text-color);
  line-height: 150%;
  font-family: 'Source Sans Pro', sans-serif;
  background-color: var(--body-bg);
  display: flex;
  flex-direction: column;
  height: 100vh; /* Ocupar toda a altura da viewport */
}

a {
  color: var(--secondary-color);
}

hr {
  width: 80%;
  border-top: 1px solid var(--border-color);
  border-bottom: 0;
  margin: 10px auto;
}

.footer {
  text-align: center;
  background-color: var(--body-bg);
  padding: 10px 0;
  border-top: 1px solid var(--border-color);
  margin-top: auto; /* Footer na parte inferior */
}

/* Estilos para o container principal */
.main-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
  flex-grow: 1; /* Permitir que o container principal cresça e ocupe o espaço restante */
  overflow: hidden; /* Esconder qualquer overflow, mas tentaremos evitar isso */
}

@media only screen and (min-width: 768px) {
  .main-container {
    flex-direction: row;
    justify-content: space-around;
    margin: 10px;
  }
  .video-container {
    max-width: 60%;
  }
  .chat-container {
    max-width: 35%;
  }
}

/* Estilos para o container do vídeo */
.video-container {
  width: 100%;
  margin-bottom: 10px;
  display: flex;
  flex-direction: column;
  max-height: 45vh; /* 45% da altura da tela */
}

.video-link {
  text-align: center;
  font-size: 0.9em;
  margin-bottom: 5px;
}

video {
  max-width: 100%;
  height: auto;
  object-fit: contain;
  border: 1px solid var(--border-color);
  max-height: 100%; /* O vídeo ocupa toda a altura do container */
}

.video-controls form {
  margin-top: 5px;
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: center; /* Centralizar os controles */
}

.video-controls label {
  display: flex;
  align-items: center;
  gap: 5px;
}

.video-controls input[type="file"],
.video-controls input[type="number"] {
  background-color: var(--input-bg);
  color: var(--input-color);
  border: 1px solid var(--border-color);
  padding: 5px;
  border-radius: 5px;
  font-size: 0.8em;
}

/* Estilos para o container do chat */
.chat-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  max-height: 55vh; /* 55% da altura da tela */
}

.msger {
  display: flex;
  flex-flow: column wrap;
  justify-content: space-between;
  width: 100%;
  max-width: 100%;
  height: 100%; /* O chat ocupa toda a altura disponível no container */
  border: 1px solid var(--border-color);
  border-radius: 5px;
  background: var(--msger-bg);
  box-shadow: 0 15px 15px -5px rgba(0, 0, 0, 0.2);
}

.msger-header {
  display: flex;
  justify-content: space-between;
  padding: 8px;
  border-bottom: 1px solid var(--border-color);
  background: var(--msger-header-bg);
  color: var(--text-color);
  font-size: 0.9em;
}

.msger-chat {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}
.msger-chat::-webkit-scrollbar {
  width: 4px;
}
.msger-chat::-webkit-scrollbar-track {
  background: #555;
}
.msger-chat::-webkit-scrollbar-thumb {
  background: #888;
}
.msg {
  display: flex;
  align-items: flex-start;
  margin-bottom: 8px;
}
.msg:last-of-type {
  margin: 0;
}
.msg-img {
  width: 30px;
  height: 30px;
  margin-right: 8px;
  background: #ddd;
  background-repeat: no-repeat;
  background-position: center;
  background-size: cover;
  border-radius: 50%;
}
.msg-bubble {
  max-width: 80%;
  padding: 8px;
  border-radius: 8px;
  background: var(--left-msg-bg);
  color: var(--text-color);
  font-size: 0.85em;
}
.msg-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 3px;
}
.msg-info-name {
  margin-right: 8px;
  font-weight: bold;
  font-size: 0.8em;
}
.msg-info-time {
  font-size: 0.7em;
  color: #ccc;
}

.right-msg {
  flex-direction: row-reverse;
}
.right-msg .msg-bubble {
  background: var(--right-msg-bg);
  color: var(--text-color);
  border-bottom-right-radius: 0;
}
.right-msg .msg-img {
  margin: 0 0 0 8px;
}

.msger-inputarea {
  display: flex;
  padding: 8px;
  border-top: 1px solid var(--border-color);
  background: var(--msger-header-bg);
}
.msger-inputarea * {
  padding: 8px;
  border: none;
  border-radius: 3px;
  font-size: 0.9em;
}
.msger-input {
  flex: 1;
  background: var(--input-bg);
  color: var(--input-color);
}
.msger-send-btn {
  margin-left: 8px;
  background: var(--primary-color);
  color: var(--text-color);
  font-weight: bold;
  cursor: pointer;
  transition: background 0.23s;
  font-size: 0.9em;
  padding: 8px 12px;
}
.msger-send-btn:hover {
  background: var(--secondary-color);
}

.input_smaller {
  width: auto; /* Largura automática para caber o conteúdo */
  height: 1.5rem;
  background: var(--input-bg);
  color: var(--input-color);
  border: 1px solid var(--border-color);
  border-radius: 5px;
  margin-left: 8px;
  font-size: 0.8em;
  padding: 5px;
}
</style>
</head>
<body>
<div class="main-container">
  <div class="video-container">
    <h3 class="video-link"><a href="https://support.google.com/chromecast/answer/3228332" target="_blank">Cast this tab/screen</a> (with subtitles) from Chrome</h3>
    <video controls autoplay onloadstart="this.volume=0.3" style="max-height: 100%;">
      </video>
    <div class="video-controls">
      <form>
        <label for="videoInput"><i class="fas fa-video"></i></label>
        <input name="video" type="file" accept="video/*" id="videoInput" style="display: none;">
        <label for="trackInput"><i class="fas fa-closed-captioning"></i></label>
        <input name="track" type="file" accept=".srt" id="trackInput" style="display: none;">
        <label for="lineMargin"><i class="fas fa-text-height"></i></label>
        <input type="number" min="-20" value="-3" max="100" step="1" id="input-change-line" style="width: 60px;">
      </form>
    </div>
  </div>

  <div class="chat-container">
    <section class="msger">
      <header class="msger-header">
        <div class="msger-header-title">
          <i class="fas fa-comment-alt"></i> Chat
        </div>
        <input class="input_smaller" type="text" id="name" placeholder="Seu Nome">
        <div class="msger-header-options">
          <span><i class="fas fa-cog"></i></span>
        </div>
      </header>

      <main class="msger-chat">
      </main>

      <form class="msger-inputarea">
        <input type="text" class="msger-input" placeholder="Digite sua mensagem...">
        <button type="submit" class="msger-send-btn">Enviar</button>
      </form>
    </section>
  </div>
</div>

<div class="footer">
  <hr>
</div>

<script type="module">
/* ... (mesmo código JavaScript do seu primeiro HTML) ... */
import { transformSrtTracks } from 'https://cdn.jsdelivr.net/gh/codeit-ninja/SRT-Support-for-HTML5-videos@master/dist/main.es.js';
var track_elem = document.querySelector('track');

document.querySelector('#input-change-line').addEventListener('change',initialize_test,false);
document.querySelector('[name="video"]').addEventListener("change", function() {
  loader(this);
});
document.querySelector('[name="track"]').addEventListener("change", function() {
  loader(this);
});
document.querySelector('video').addEventListener('loadedmetadata',resize, false);

function resize(video) {
	var video = document.querySelector('video');
	video.width = video.videoWidth*1.5;
};

function loader(elm) {
	if (elm.name != 'track')
		document.querySelector(elm.name).src = URL.createObjectURL(elm.files[0]);

	if (elm.name == 'track') {
		var elm_actual;
		if (document.querySelectorAll(elm.name).length>0) {
			elm_actual = document.querySelector(elm.name);
			for (var i = elm_actual.parentNode.textTracks.length - 1; i >= 0; i--)
				elm_actual.parentNode.textTracks[i].mode = "disabled";
			document.querySelector(elm.name).parentNode.removeChild(document.querySelector(elm.name));
		}
		var track = document.createElement('track');
		var elm_actual = document.querySelector('video').appendChild(track), encoding, is_srt;
		document.querySelector(elm.name).src = URL.createObjectURL(elm.files[0]);
		initialize_test();
		elm_actual.setAttribute('kind', 'subtitles');
		elm_actual.setAttribute('default', '');
		is_srt = elm.files[0].name.toLowerCase().endsWith('.srt');
		languageEncoding(elm.files[0]).then(fileInfo => {encoding = fileInfo.encoding;
			if (encoding !== null) {
				elm_actual.setAttribute('label', fileInfo.language == null ? 'Unknown' : fileInfo.language.replace(/^./, str => str.toUpperCase()));
				if (is_srt)
					elm_actual.setAttribute('data-encoding', encoding);
			}
			if (is_srt)
				transformSrtTracks(elm_actual.parentNode);
		});
	}
}

function initialize_test() {
  var i, j, track, video = document.querySelector('video');
  track = video.textTracks;
  for (i=0; i<track.length; i++) {
	if (track[i].cues != null)
		for (j=0; j<track[i].cues.length; j++)
			track[i].cues[j].line = parseInt(document.querySelector('#input-change-line').value);
  }
}
</script>

<script>
  // Código JavaScript do seu segundo HTML (chat.html)
  const msgerForm = get(".msger-inputarea");
  const msgerInput = get(".msger-input");
  const msgerChat = get(".msger-chat");

  const BOT_CMDS = {
    '/initial': 'Olá, bem-vindo ao Chat! Use <code>/</code> para comandos (ex: <code>/pause</code>)',
    '/pause': 'Vídeo pausado',
    '/play': 'Vídeo reproduzindo'
  }

  const BOT_MSGS = [
    "Oi, tudo bem?",
    "Hmm... Não entendi o que você quis dizer. Desculpe!",
    "Eu gosto de jogar... Mas não sei como jogar!",
    "Desculpe se minhas respostas não são relevantes. :))",
    "Estou com sono! :("
  ];

  const BOT_IMG = "";
  const PERSON_IMG = "";
  const BOT_NAME = "BOT";
  const PERSON_NAME = "";
  const BOT_CMD_ONLY = true;

  botResponse('/initial');
  msgerForm.addEventListener("submit", event => {
    event.preventDefault();

    const msgText = msgerInput.value;
    if (!msgText) return;

    var host = get("#name");
    if (host.value != '')
      host = host.value;
    else
      host = host.placeholder.split(' ', 1)[0];

    appendMessage(host, PERSON_IMG, "right", msgText);
    msgerInput.value = "";

    if (!BOT_CMD_ONLY || msgText.charAt() == '/')
     botResponse(msgText);
  });

  function appendMessage(name, img, side, text) {
    const msgHTML = `
      <div class="msg ${side}-msg">
        <div class="msg-img" style="background-image: url(${img})"></div>

        <div class="msg-bubble">
          <div class="msg-info">
            <div class="msg-info-name">${name}</div>
            <div class="msg-info-time">${formatDate(new Date())}</div>
          </div>

          <div class="msg-text">${text}</div>
        </div>
      </div>
    `;

    msgerChat.insertAdjacentHTML("beforeend", msgHTML);
    // Rolagem automática para a última mensagem
    msgerChat.scrollTop = msgerChat.scrollHeight;
  }

  function botResponse(themsg) {
    if (BOT_CMDS[themsg])
      appendMessage(BOT_NAME, BOT_IMG, "left", BOT_CMDS[themsg]);
    else {
      const r = random(0, BOT_MSGS.length - 1);
      const msgText = BOT_MSGS[r];
      const delay = msgText.split(" ").length * 100;

      setTimeout(() => {
        appendMessage(BOT_NAME, BOT_IMG, "left", msgText);
      }, delay);
    }
  }

  function get(selector, root = document) {
    return root.querySelector(selector);
  }

  function formatDate(date) {
    const h = "0" + date.getHours();
    const m = "0" + date.getMinutes();

    return `${h.slice(-2)}:${m.slice(-2)}`;
  }

  function random(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
  }
</script>

</body>
</html>